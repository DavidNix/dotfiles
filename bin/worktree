#!/bin/bash
# Create a git worktree for isolated feature work
# Usage: worktree <branch-name>

set -euo pipefail

# Require branch name argument
if [[ $# -lt 1 ]]; then
    echo "Usage: -worktree <branch-name>"
    exit 1
fi

branch_name="$1"
worktree_path="../worktrees/${branch_name}"

mkdir -p ../worktrees

git worktree add "$worktree_path" -b "$branch_name"

if [[ -f .env ]]; then
    cp .env "$worktree_path/"
    echo "Copied .env"
else
    echo "Warning: .env not found, skipped"
fi

if [[ -f .envrc ]]; then
    cp .envrc "$worktree_path/"
    echo "Copied .envrc"
else
    echo "Warning: .envrc not found, skipped"
fi

abs_path="$(cd "$worktree_path" && pwd)"
echo ""
echo "Worktree created at: ${abs_path}"
echo "Branch: ${branch_name}"
echo ""

# Spawn a new shell in the worktree directory
cd "$abs_path"
exec $SHELL
